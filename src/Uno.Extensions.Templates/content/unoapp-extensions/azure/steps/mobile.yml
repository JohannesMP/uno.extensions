parameters:
- name: project_to_build
  type: string
  default: ''
  #'net$ciTargetDotNetVersion$-android, net$ciTargetDotNetVersion$-ios, net$ciTargetDotNetVersion$-maccatalyst'
- name: target_framework
  type: string
  default: ''
- name: publish_artifacts
  type: string
  default: 'true'      
- name: compress_artifacts
  type: string
  default: 'true'      

steps:
    #Validate required parameters before executing any other script
    - task: PowerShell@2
      displayName: 'Verify required parameters'
      inputs:
        targetType: 'inline'
        script: |
            $errors = ''
            if ('' -eq '${{ parameters.project_to_build }}') { $errors = $errors + '[project_to_build] is not valid.' + "`r`n"  }
            if ('' -eq '${{ parameters.target_framework }}') { $errors = $errors + '[target_framework] is not valid' + "`r`n"  }
            
            if (-not ([string]::IsNullOrEmpty($errors))){
                $errors
                throw "Some required parameters are missing"
            }

    - template: gitversion.yml

    - task: PowerShell@2
      displayName: 'Build and Package'
      inputs:
        targetType: 'filePath'
        filePath: 'build/scripts/mobile_build.ps1'
        arguments: >
                -project_to_build "${{ parameters.project_to_build }}"
                -target_framework "${{ parameters.target_framework }}"
                -publish_artifacts "${{ parameters.publish_artifacts }}"
                -compress_artifacts "${{ parameters.compress_artifacts }}"
                -git_semVer "$(GitVersion.AssemblySemVer)"

    - task: PublishPipelineArtifact@1
      displayName: 'Publish Artifact'
      condition:  eq('${{ parameters.publish_artifacts }}', 'true')
      inputs:
        targetPath: artifacts
        artifactName: ${{parameters.target_framework}}_$(GitVersion.AssemblySemVer)
    